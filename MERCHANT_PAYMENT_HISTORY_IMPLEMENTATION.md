# å•†å®¶æ”¯ä»˜å†å²åŠŸèƒ½å®ç°

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸º scan-pay åŠŸèƒ½æ·»åŠ äº†ä¸“é—¨çš„æ”¯ä»˜å†å²é¡µé¢ï¼ŒåŒºåˆ«äºæ‰¹é‡è½¬è´¦å†å²ï¼ˆ/historyï¼‰ã€‚

## ğŸ¯ å®ç°å†…å®¹

### 1. åç«¯ API

**æ–‡ä»¶**: `/app/api/v1/payments/merchant-payment/history/route.ts`

**åŠŸèƒ½**:
- è·å–å½“å‰ç™»å½•ç”¨æˆ·é€šè¿‡æ‰«ç æ”¯ä»˜ç»™å•†å®¶çš„æ‰€æœ‰è®°å½•
- æŒ‰æ—¶é—´å€’åºæ’åˆ—
- åŒ…å«å®Œæ•´çš„äº¤æ˜“è¯¦æƒ…å’Œå•†å®¶ä¿¡æ¯

**è¿”å›æ•°æ®ç»“æ„**:
```typescript
{
  data: [
    {
      id: string,
      merchantUid: string,        // å•†å®¶çš„ UID
      merchantUsername: string,   // å•†å®¶çš„ç”¨æˆ·å
      totalAmount: number,        // æ€»æ”¯ä»˜é‡‘é¢ï¼ˆæ‰£é™¤ 0.01 Pi åï¼‰
      merchantAmount: number,     // å•†å®¶æ”¶åˆ°çš„ 95%
      dividendAmount: number,     // åˆ†çº¢æ± çš„ 5%
      u2aPaymentId: string,      // U2A æ”¯ä»˜ IDï¼ˆç”¨æˆ·åˆ° Appï¼‰
      u2aTxid: string,           // U2A äº¤æ˜“ ID
      a2uPaymentId: string,      // A2U æ”¯ä»˜ IDï¼ˆApp åˆ°å•†å®¶ï¼‰
      a2uTxid: string,           // A2U äº¤æ˜“ ID
      a2uStatus: string,         // A2U çŠ¶æ€
      a2uErrorMessage: string,   // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
      createdAt: string,         // åˆ›å»ºæ—¶é—´
      completedAt: string,       // å®Œæˆæ—¶é—´
    }
  ]
}
```

**æŸ¥è¯¢é€»è¾‘**:
```sql
SELECT * FROM MerchantPayment
WHERE payerUid = 'å½“å‰ç”¨æˆ·çš„ Pi UID'
ORDER BY createdAt DESC
```

### 2. å‰ç«¯é¡µé¢

**æ–‡ä»¶**: `/app/merchant-payment-history/page.tsx`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… æ˜¾ç¤ºæ‰€æœ‰å•†å®¶æ”¯ä»˜è®°å½•
- âœ… å±•ç¤ºæ”¯ä»˜ç»™çš„å•†å®¶ä¿¡æ¯ï¼ˆç”¨æˆ·å + UIDï¼‰
- âœ… åˆ†åˆ«æ˜¾ç¤ºä¸‰ä¸ªé‡‘é¢ï¼šæ€»æ”¯ä»˜ã€å•†å®¶æ”¶åˆ°ã€åˆ†çº¢è´¡çŒ®
- âœ… å¯å±•å¼€æŸ¥çœ‹è¯¦ç»†äº¤æ˜“ä¿¡æ¯
- âœ… æ˜¾ç¤º U2A å’Œ A2U ä¸¤ä¸ªäº¤æ˜“çš„å®Œæ•´è¯¦æƒ…
- âœ… å®æ—¶çŠ¶æ€æ›´æ–°
- âœ… ç©ºçŠ¶æ€æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- âœ… ä¸å…¶ä»–é¡µé¢é£æ ¼ä¸€è‡´

**UI ç»„ä»¶**:
1. **å¡ç‰‡æ¦‚è§ˆ**:
   - å•†å®¶ç”¨æˆ·åå’Œ UID
   - æ”¯ä»˜çŠ¶æ€æ ‡è¯†
   - ä¸‰åˆ—é‡‘é¢æ˜¾ç¤ºï¼ˆæ€»é¢ã€å•†å®¶ã€åˆ†çº¢ï¼‰
   - æ”¯ä»˜æ—¶é—´

2. **å±•å¼€è¯¦æƒ…**:
   - U2A äº¤æ˜“è¯¦æƒ…ï¼ˆç”¨æˆ·åˆ° Appï¼‰
   - A2U äº¤æ˜“è¯¦æƒ…ï¼ˆApp åˆ°å•†å®¶ï¼‰
   - åˆ†çº¢æ± è´¡çŒ®è¯´æ˜
   - å®Œæˆæ—¶é—´

3. **ç©ºçŠ¶æ€**:
   - NoTx å›¾æ ‡
   - å‹å¥½çš„æç¤ºæ–‡æ¡ˆ

### 3. å¯¼èˆªé“¾æ¥æ›´æ–°

**ä¿®æ”¹**: `/app/scan-pay/page.tsx`
- å°† Payment History æŒ‰é’®çš„é“¾æ¥ä» `/history` æ”¹ä¸º `/merchant-payment-history`
- æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥å’Œå˜é‡

## ğŸ”„ é¡µé¢å…³ç³»å›¾

```
ä¸»é¡µ (/)
  â”‚
  â”œâ”€ Merchant Code (/merchant-code)
  â”‚    â””â”€ (å•†å®¶æ³¨å†Œå’Œåˆ†çº¢ç®¡ç†)
  â”‚
  â”œâ”€ Scan Pay (/scan-pay)
  â”‚    â”œâ”€ Payment History â†’ /merchant-payment-history âœ… æ–°å¢
  â”‚    â””â”€ (æ‰«ç æ”¯ä»˜åŠŸèƒ½)
  â”‚
  â”œâ”€ One-to-N (/oneton)
  â”‚    â”œâ”€ Transaction History â†’ /history
  â”‚    â””â”€ (æ‰¹é‡è½¬è´¦åŠŸèƒ½)
  â”‚
  â””â”€ Red Envelope (/red-envelope)
       â””â”€ (çº¢åŒ…åŠŸèƒ½)
```

## ğŸ“Š æ•°æ®æµç¨‹

### å•†å®¶æ”¯ä»˜è®°å½•çš„ç”Ÿæˆ

```
ç”¨æˆ·åœ¨ scan-pay æ‰«ç æ”¯ä»˜
  â†“
è°ƒç”¨ /api/v1/payments/merchant-payment
  â†“
åˆ›å»º MerchantPayment è®°å½•:
  - payerUid: ç”¨æˆ·çš„ UID
  - merchantPaycodeId: å•†å®¶ ID
  - totalAmount: å®é™…æ”¯ä»˜é‡‘é¢
  - merchantAmount: 95%
  - dividendAmount: 5%
  - u2aPaymentId, u2aTxid
  - a2uPaymentId, a2uTxid
  - a2uStatus: pending â†’ created â†’ submitted â†’ completed
  â†“
å¼‚æ­¥å¤„ç† A2U è½¬è´¦ç»™å•†å®¶
  â†“
æ›´æ–° a2uStatus ä¸º completed
```

### å†å²è®°å½•çš„æŸ¥è¯¢

```
ç”¨æˆ·è®¿é—® /merchant-payment-history
  â†“
å‰ç«¯è°ƒç”¨ /api/v1/payments/merchant-payment/history
  â†“
åç«¯æŸ¥è¯¢:
  - é€šè¿‡ payerUid æ‰¾åˆ°æ‰€æœ‰æ”¯ä»˜è®°å½•
  - å…³è”æŸ¥è¯¢å•†å®¶ä¿¡æ¯
  - æŒ‰æ—¶é—´å€’åºæ’åˆ—
  â†“
è¿”å›æ ¼å¼åŒ–çš„æ•°æ®
  â†“
å‰ç«¯æ¸²æŸ“åˆ—è¡¨
```

## ğŸ¨ UI å±•ç¤ºç¤ºä¾‹

### æ”¯ä»˜è®°å½•å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Payment to Merchant              Completed  â”‚
â”‚ @john_merchant                              â”‚
â”‚ e0b8b25b-23b0-4849...                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Total paid    To merchant    Dividend       â”‚
â”‚ 3.13 Pi       2.9735 Pi      0.1565 Pi     â”‚
â”‚                                             â”‚
â”‚ 2025-10-21, 14:30                          â”‚
â”‚                                             â”‚
â”‚        View details â–¼                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å±•å¼€è¯¦æƒ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transaction details:                        â”‚
â”‚                                             â”‚
â”‚ Your Payment (U2A)                          â”‚
â”‚ Payment ID: pi_abc123...                    â”‚
â”‚ Transaction ID: tx_xyz789...                â”‚
â”‚ Amount: 3.13 Pi                             â”‚
â”‚                                             â”‚
â”‚ Transfer to Merchant (A2U)                  â”‚
â”‚ Payment ID: pi_def456...                    â”‚
â”‚ Transaction ID: tx_uvw012...                â”‚
â”‚ Amount: 2.9735 Pi                           â”‚
â”‚ Status: Completed                           â”‚
â”‚                                             â”‚
â”‚ Dividend Pool Contribution                  â”‚
â”‚ 0.1565 Pi                                   â”‚
â”‚ 5% of your payment goes to the merchant's   â”‚
â”‚ dividend pool                               â”‚
â”‚                                             â”‚
â”‚ Completed: 2025-10-21, 14:30:15            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ åŠŸèƒ½äº®ç‚¹

### 1. æ¸…æ™°çš„é‡‘é¢åˆ†è§£
- **æ€»æ”¯ä»˜**: ç”¨æˆ·å®é™…æ”¯ä»˜çš„é‡‘é¢ï¼ˆå·²æ‰£ 0.01 Piï¼‰
- **å•†å®¶æ”¶åˆ°**: 95% çš„é‡‘é¢
- **åˆ†çº¢è´¡çŒ®**: 5% è¿›å…¥å•†å®¶åˆ†çº¢æ± 

### 2. å®Œæ•´çš„äº¤æ˜“è¿½è¸ª
- **U2A é˜¶æ®µ**: ç”¨æˆ·æ”¯ä»˜åˆ° App wallet
- **A2U é˜¶æ®µ**: App wallet è½¬è´¦ç»™å•†å®¶
- ä¸¤ä¸ªé˜¶æ®µéƒ½æœ‰ç‹¬ç«‹çš„ paymentId å’Œ txid

### 3. çŠ¶æ€å®æ—¶æ›´æ–°
- `pending` - ç­‰å¾…å¤„ç†
- `created` - A2U æ”¯ä»˜å·²åˆ›å»º
- `submitted` - å·²æäº¤åˆ°åŒºå—é“¾
- `completed` - è½¬è´¦å®Œæˆ
- `failed` - è½¬è´¦å¤±è´¥ï¼ˆæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼‰

### 4. å•†å®¶ä¿¡æ¯å±•ç¤º
- å•†å®¶ç”¨æˆ·å
- å•†å®¶ UIDï¼ˆéƒ¨åˆ†æ˜¾ç¤ºï¼‰
- æ–¹ä¾¿ç”¨æˆ·è¯†åˆ«æ”¯ä»˜å»å‘

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶
ç¡®ä¿å·²ç»ï¼š
1. âœ… æ³¨å†Œäº†å•†å®¶äºŒç»´ç 
2. âœ… é€šè¿‡ scan-pay å®Œæˆè‡³å°‘ä¸€ç¬”æ”¯ä»˜

### æµ‹è¯•æµç¨‹

1. **è®¿é—®æ”¯ä»˜å†å²é¡µé¢**:
   ```
   æ‰“å¼€ scan-pay é¡µé¢
     â†“
   ç‚¹å‡» "Payment History" æŒ‰é’®
     â†“
   åº”è¯¥è·³è½¬åˆ° /merchant-payment-history
   ```

2. **éªŒè¯æ•°æ®æ˜¾ç¤º**:
   - âœ… æ˜¾ç¤ºä½ ä¹‹å‰çš„æ”¯ä»˜è®°å½•
   - âœ… å•†å®¶ä¿¡æ¯æ­£ç¡®
   - âœ… é‡‘é¢åˆ†è§£æ­£ç¡®ï¼ˆæ€»é¢ = å•†å®¶ + åˆ†çº¢ï¼‰
   - âœ… æ—¶é—´æ˜¾ç¤ºæ­£ç¡®

3. **æµ‹è¯•å±•å¼€åŠŸèƒ½**:
   ```
   ç‚¹å‡» "View details"
     â†“
   åº”è¯¥å±•å¼€æ˜¾ç¤ºäº¤æ˜“è¯¦æƒ…
     â†“
   å†æ¬¡ç‚¹å‡» "Hide details"
     â†“
   åº”è¯¥æ”¶èµ·è¯¦æƒ…
   ```

4. **æµ‹è¯•ç©ºçŠ¶æ€**:
   - ä½¿ç”¨æ–°ç”¨æˆ·è®¿é—®ï¼ˆæ²¡æœ‰æ”¯ä»˜è®°å½•ï¼‰
   - åº”è¯¥æ˜¾ç¤º "No payments yet" å’Œæç¤ºä¿¡æ¯

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | é¢„æœŸç»“æœ |
|------|----------|
| æœ‰æ”¯ä»˜è®°å½• | æ˜¾ç¤ºæ”¯ä»˜åˆ—è¡¨ï¼ŒæŒ‰æ—¶é—´å€’åº |
| æ— æ”¯ä»˜è®°å½• | æ˜¾ç¤ºç©ºçŠ¶æ€å›¾æ ‡å’Œæç¤º |
| ç‚¹å‡»å±•å¼€ | æ˜¾ç¤ºäº¤æ˜“è¯¦ç»†ä¿¡æ¯ |
| A2U å¤„ç†ä¸­ | çŠ¶æ€æ˜¾ç¤ºä¸º "Pending" æˆ– "Created" |
| A2U å®Œæˆ | çŠ¶æ€æ˜¾ç¤ºä¸º "Completed"ï¼Œç»¿è‰²æ ‡è¯† |
| A2U å¤±è´¥ | çŠ¶æ€æ˜¾ç¤ºä¸º "Failed"ï¼Œçº¢è‰²æ ‡è¯†ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |

## ğŸ” æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰å•†å®¶æ”¯ä»˜ï¼š

```sql
SELECT 
  mp.*,
  mc.merchantUid,
  u.username as merchantUsername
FROM "MerchantPayment" mp
JOIN "MerchantPaycode" mc ON mp."merchantPaycodeId" = mc.id
JOIN "PiUser" u ON mc."ownerUserId" = u.id
WHERE mp."payerUid" = 'e0b8b25b-23b0-4849-a5b0-0fc06c94b14d'
ORDER BY mp."createdAt" DESC;
```

## ğŸ“ ä¸æ‰¹é‡è½¬è´¦å†å²çš„åŒºåˆ«

| ç‰¹æ€§ | å•†å®¶æ”¯ä»˜å†å² | æ‰¹é‡è½¬è´¦å†å² |
|------|--------------|--------------|
| é¡µé¢è·¯å¾„ | `/merchant-payment-history` | `/history` |
| å…¥å£ | scan-pay é¡µé¢ | oneton é¡µé¢ |
| æ•°æ®æ¥æº | `MerchantPayment` è¡¨ | `BatchTransferTask` è¡¨ |
| æ”¯ä»˜ç±»å‹ | U2A + A2U | U2A + å¤šä¸ª A2U |
| é‡‘é¢æ˜¾ç¤º | æ€»é¢ã€å•†å®¶ã€åˆ†çº¢ | æ€»é¢ã€æ¯ä¸ªæ”¶æ¬¾äºº |
| å±•å¼€è¯¦æƒ… | U2A + A2U äº¤æ˜“ä¿¡æ¯ | U2A + æ‰€æœ‰ A2U åˆ—è¡¨ |

## ğŸ¯ æœªæ¥å¯èƒ½çš„å¢å¼º

1. **ç­›é€‰åŠŸèƒ½**:
   - æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
   - æŒ‰å•†å®¶ç­›é€‰
   - æŒ‰çŠ¶æ€ç­›é€‰

2. **ç»Ÿè®¡ä¿¡æ¯**:
   - æ€»æ”¯ä»˜é‡‘é¢
   - æ€»åˆ†çº¢è´¡çŒ®
   - æœ€å¸¸æ”¯ä»˜çš„å•†å®¶

3. **æœç´¢åŠŸèƒ½**:
   - æŒ‰å•†å®¶ç”¨æˆ·åæœç´¢
   - æŒ‰é‡‘é¢èŒƒå›´æœç´¢

4. **å¯¼å‡ºåŠŸèƒ½**:
   - å¯¼å‡ºä¸º CSV
   - ç”Ÿæˆæ”¯ä»˜æŠ¥è¡¨

5. **å®æ—¶æ›´æ–°**:
   - WebSocket å®æ—¶æ¨é€æ”¯ä»˜çŠ¶æ€
   - è‡ªåŠ¨åˆ·æ–°æœªå®Œæˆçš„æ”¯ä»˜

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- âœ… `/app/api/v1/payments/merchant-payment/history/route.ts` - åç«¯ API
- âœ… `/app/merchant-payment-history/page.tsx` - å‰ç«¯é¡µé¢

### ä¿®æ”¹æ–‡ä»¶
- âœ… `/app/scan-pay/page.tsx` - æ›´æ–° Payment History é“¾æ¥

### ç›¸å…³æ–‡æ¡£
- `MERCHANT_PAYMENT_IMPLEMENTATION.md` - å•†å®¶æ”¯ä»˜ç³»ç»Ÿå®ç°
- `INCOMPLETE_PAYMENT_FINAL_FIX.md` - Incomplete payment ä¿®å¤

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·æµç¨‹

1. **è¿›è¡Œå•†å®¶æ”¯ä»˜**:
   ```
   scan-pay é¡µé¢ â†’ æ‰«æå•†å®¶äºŒç»´ç  â†’ è¾“å…¥é‡‘é¢ â†’ æ”¯ä»˜
   ```

2. **æŸ¥çœ‹æ”¯ä»˜å†å²**:
   ```
   scan-pay é¡µé¢ â†’ ç‚¹å‡» "Payment History" â†’ æŸ¥çœ‹æ‰€æœ‰æ”¯ä»˜è®°å½•
   ```

3. **æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯**:
   ```
   æ”¯ä»˜å†å²é¡µé¢ â†’ ç‚¹å‡» "View details" â†’ æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…
   ```

### æ•°æ®å±•ç¤º

æ¯æ¡æ”¯ä»˜è®°å½•æ˜¾ç¤ºï¼š
- **åŸºæœ¬ä¿¡æ¯**: å•†å®¶ç”¨æˆ·åã€UIDã€æ”¯ä»˜æ—¶é—´
- **é‡‘é¢ä¿¡æ¯**: æ€»æ”¯ä»˜ã€å•†å®¶æ”¶åˆ°ã€åˆ†çº¢è´¡çŒ®
- **çŠ¶æ€ä¿¡æ¯**: A2U è½¬è´¦çŠ¶æ€ï¼ˆå®æ—¶æ›´æ–°ï¼‰
- **äº¤æ˜“è¯¦æƒ…**: 
  - U2A: ä½ çš„æ”¯ä»˜ ID å’Œäº¤æ˜“ ID
  - A2U: è½¬ç»™å•†å®¶çš„æ”¯ä»˜ ID å’Œäº¤æ˜“ ID
  - åˆ†çº¢æ± è´¡çŒ®é‡‘é¢

## ğŸ’¡ è®¾è®¡è€ƒè™‘

### ä¸ºä»€ä¹ˆéœ€è¦ç‹¬ç«‹çš„å†å²é¡µé¢ï¼Ÿ

1. **ä¸åŒçš„ä¸šåŠ¡é€»è¾‘**:
   - å•†å®¶æ”¯ä»˜ï¼šå•ç¬”æ”¯ä»˜ â†’ è‡ªåŠ¨åˆ†è´¦ â†’ è½¬ç»™å•†å®¶
   - æ‰¹é‡è½¬è´¦ï¼šå•ç¬”æ”¯ä»˜ â†’ å¤šç¬”è½¬è´¦ç»™ä¸åŒç”¨æˆ·

2. **ä¸åŒçš„æ•°æ®æ¨¡å‹**:
   - å•†å®¶æ”¯ä»˜ï¼š`MerchantPayment` è¡¨
   - æ‰¹é‡è½¬è´¦ï¼š`BatchTransferTask` + `A2UPayment` è¡¨

3. **ä¸åŒçš„ç”¨æˆ·å…³æ³¨ç‚¹**:
   - å•†å®¶æ”¯ä»˜ï¼šå…³å¿ƒæ”¯ä»˜ç»™è°ã€åˆ†è´¦æ¯”ä¾‹ã€å•†å®¶æ”¶åˆ°å¤šå°‘
   - æ‰¹é‡è½¬è´¦ï¼šå…³å¿ƒæ¯ä¸ªæ”¶æ¬¾äººçš„çŠ¶æ€ã€æ€»ä½“å®Œæˆæƒ…å†µ

### ä¸ºä»€ä¹ˆä¸åˆå¹¶åˆ°ä¸€ä¸ªé¡µé¢ï¼Ÿ

è™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥åˆå¹¶ï¼Œä½†åˆ†å¼€æœ‰ä»¥ä¸‹å¥½å¤„ï¼š
- âœ… æ›´æ¸…æ™°çš„ç”¨æˆ·ä½“éªŒ
- âœ… æ›´ç®€æ´çš„ä»£ç é€»è¾‘
- âœ… æ›´å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•
- âœ… å‡å°‘è®¤çŸ¥è´Ÿæ‹…

## ğŸ”— é¡µé¢å¯¼èˆª

### scan-pay é¡µé¢çš„æŒ‰é’®

```tsx
<Link href="/merchant-payment-history">
  Payment History
</Link>
```

### merchant-payment-history é¡µé¢çš„è¿”å›

```tsx
<Link href="/scan-pay">
  <BackIcon /> (è¿”å› scan-pay)
</Link>
```

### åº•éƒ¨é¢å¤–æ“ä½œ

```tsx
<Link href="/scan-pay">
  + Make another payment
</Link>
```

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- âœ… åç«¯ API åˆ›å»ºå®Œæˆ
- âœ… å‰ç«¯é¡µé¢åˆ›å»ºå®Œæˆ
- âœ… scan-pay é“¾æ¥å·²æ›´æ–°
- âœ… æ‰€æœ‰ä»£ç é€šè¿‡ lint æ£€æŸ¥
- âœ… ä¸ç°æœ‰ UI é£æ ¼ä¸€è‡´
- âœ… æ”¯æŒç©ºçŠ¶æ€æ˜¾ç¤º
- âœ… æ”¯æŒè¯¦æƒ…å±•å¼€/æ”¶èµ·
- âœ… åŒ…å«å®Œæ•´çš„äº¤æ˜“ä¿¡æ¯

## ğŸ“± æˆªå›¾é¢„è§ˆï¼ˆé¢„æœŸæ•ˆæœï¼‰

### æœ‰è®°å½•æ—¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Merchant Payment History         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Payment to Merchant   Completed â”‚ â”‚
â”‚ â”‚ @alice_shop                     â”‚ â”‚
â”‚ â”‚ e0b8b25b-23b0...                â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ Total paid  To merchant Dividendâ”‚ â”‚
â”‚ â”‚ 3.13 Pi     2.97 Pi     0.16 Pi â”‚ â”‚
â”‚ â”‚ 2025-10-21, 14:30               â”‚ â”‚
â”‚ â”‚        View details â–¼           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Payment to Merchant   Processingâ”‚ â”‚
â”‚ â”‚ @bob_store                      â”‚ â”‚
â”‚ â”‚ ...                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚      + Make another payment         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ— è®°å½•æ—¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Merchant Payment History         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚         [NoTx Icon]                 â”‚
â”‚                                     â”‚
â”‚      No payments yet                â”‚
â”‚                                     â”‚
â”‚  Your merchant payment records      â”‚
â”‚  will be displayed here             â”‚
â”‚  Start using scan-to-pay feature    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### æ•°æ®å…³è”æŸ¥è¯¢
```typescript
prisma.merchantPayment.findMany({
  where: { payerUid: user.piUid },
  include: {
    merchantPaycode: {
      select: {
        merchantUid: true,
        owner: { select: { username: true } }
      }
    }
  }
});
```

### é‡‘é¢æ ¼å¼åŒ–
```typescript
// ä¿ç•™ 6 ä½å°æ•°
totalAmount.toFixed(6)  // "3.130000"

// æ ¹æ®éœ€è¦å¯ä»¥ä¼˜åŒ–ä¸ºå»é™¤å°¾éƒ¨ 0
Number(totalAmount.toFixed(6))  // 3.13
```

### æ—¶é—´æ ¼å¼åŒ–
```typescript
new Date(createdAt).toLocaleString('en-US', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
})
// "10/21/2025, 02:30 PM"
```

---

**å®æ–½å®Œæˆæ—¶é—´**: 2025-10-21  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯æµ‹è¯•

