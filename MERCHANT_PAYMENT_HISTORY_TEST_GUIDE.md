# å•†å®¶æ”¯ä»˜å†å²åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ¯ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

ç¡®ä¿ä½ å·²ç»ï¼š
- âœ… åœ¨ Pi Browser ä¸­ç™»å½•
- âœ… å·²æ³¨å†Œå•†å®¶äºŒç»´ç ï¼ˆåœ¨ merchant-code é¡µé¢ï¼‰
- âœ… å·²å®Œæˆè‡³å°‘ä¸€ç¬”å•†å®¶æ”¯ä»˜ï¼ˆåœ¨ scan-pay é¡µé¢ï¼‰

### æ­¥éª¤ 2: è®¿é—®å•†å®¶æ”¯ä»˜å†å²é¡µé¢

1. **ä» scan-pay é¡µé¢è¿›å…¥**:
   ```
   æ‰“å¼€ scan-pay é¡µé¢
     â†“
   å‘ä¸‹æ»šåŠ¨åˆ°åº•éƒ¨
     â†“
   ç‚¹å‡» "Payment History" æŒ‰é’®ï¼ˆç´«æ©™æ¸å˜è‰²ï¼‰
     â†“
   åº”è¯¥è·³è½¬åˆ°å•†å®¶æ”¯ä»˜å†å²é¡µé¢
   ```

2. **ç›´æ¥è®¿é—®**:
   ```
   åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥:
   http://localhost:3000/merchant-payment-history
   ```

### æ­¥éª¤ 3: éªŒè¯é¡µé¢æ˜¾ç¤º

#### åœºæ™¯ A: æœ‰æ”¯ä»˜è®°å½•

**é¢„æœŸæ˜¾ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Merchant Payment History              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ æ¯æ¡æ”¯ä»˜è®°å½•åº”è¯¥æ˜¾ç¤ºï¼š                      â”‚
â”‚ âœ“ å•†å®¶ç”¨æˆ·åï¼ˆå¦‚ @john_merchantï¼‰         â”‚
â”‚ âœ“ å•†å®¶ UIDï¼ˆéƒ¨åˆ†æ˜¾ç¤ºï¼‰                    â”‚
â”‚ âœ“ ä¸‰ä¸ªé‡‘é¢ï¼š                              â”‚
â”‚   - Total paid (ç´«æ©™æ¸å˜è‰²)              â”‚
â”‚   - To merchant (ç»¿è‰²)                   â”‚
â”‚   - Dividend (è“è‰²)                      â”‚
â”‚ âœ“ æ”¯ä»˜æ—¶é—´                               â”‚
â”‚ âœ“ A2U çŠ¶æ€ï¼ˆCompleted/Pending ç­‰ï¼‰        â”‚
â”‚ âœ“ "View details" æŒ‰é’®                   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœºæ™¯ B: æ— æ”¯ä»˜è®°å½•

**é¢„æœŸæ˜¾ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Merchant Payment History              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [NoTx SVG å›¾æ ‡]                 â”‚
â”‚                                         â”‚
â”‚       No payments yet                   â”‚
â”‚                                         â”‚
â”‚  Your merchant payment records will     â”‚
â”‚  be displayed here                      â”‚
â”‚  Start using scan-to-pay feature        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­¥éª¤ 4: æµ‹è¯•å±•å¼€è¯¦æƒ…åŠŸèƒ½

1. **ç‚¹å‡»ä»»æ„ä¸€æ¡è®°å½•çš„ "View details"**:
   - âœ… åº”è¯¥å±•å¼€æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
   - âœ… æŒ‰é’®æ–‡å­—å˜ä¸º "Hide details â–²"

2. **éªŒè¯å±•å¼€çš„è¯¦æƒ…åŒ…å«**:
   - âœ… **Your Payment (U2A)** éƒ¨åˆ†:
     - Payment ID
     - Transaction ID
     - Amount
   
   - âœ… **Transfer to Merchant (A2U)** éƒ¨åˆ†:
     - Payment ID
     - Transaction ID
     - Amount
     - Status (å¸¦é¢œè‰²æ ‡è¯†)
     - Error messageï¼ˆå¦‚æœå¤±è´¥ï¼‰
   
   - âœ… **Dividend Pool Contribution** éƒ¨åˆ†:
     - åˆ†çº¢é‡‘é¢
     - è¯´æ˜æ–‡å­—

   - âœ… **Completed time**ï¼ˆå¦‚æœå·²å®Œæˆï¼‰

3. **å†æ¬¡ç‚¹å‡» "Hide details"**:
   - âœ… åº”è¯¥æ”¶èµ·è¯¦æƒ…

### æ­¥éª¤ 5: éªŒè¯æ•°æ®å‡†ç¡®æ€§

1. **æ£€æŸ¥é‡‘é¢è®¡ç®—**:
   ```
   éªŒè¯å…¬å¼ï¼š
   totalAmount = merchantAmount + dividendAmount
   merchantAmount = floor(totalAmount * 0.95 * 1000000) / 1000000
   dividendAmount = ceil(totalAmount * 0.05 * 1000000) / 1000000
   
   ç¤ºä¾‹ï¼š
   å¦‚æœ totalAmount = 3.13 Pi
   åˆ™ merchantAmount = 2.9735 Pi (95%)
   åˆ™ dividendAmount = 0.1565 Pi (5%)
   æ€»å’Œ = 3.13 Pi âœ“
   ```

2. **æ£€æŸ¥å•†å®¶ä¿¡æ¯**:
   - âœ… å•†å®¶ç”¨æˆ·ååº”è¯¥åŒ¹é…ä½ æ”¯ä»˜çš„å•†å®¶
   - âœ… å•†å®¶ UID åº”è¯¥æ­£ç¡®æ˜¾ç¤º

3. **æ£€æŸ¥çŠ¶æ€**:
   - âœ… å¦‚æœ A2U è½¬è´¦å®Œæˆï¼ŒçŠ¶æ€åº”ä¸º "Completed"ï¼ˆç»¿è‰²ï¼‰
   - âœ… å¦‚æœè¿˜åœ¨å¤„ç†ï¼ŒçŠ¶æ€åº”ä¸º "Pending" æˆ– "Created"ï¼ˆç°è‰²/é»„è‰²ï¼‰

### æ­¥éª¤ 6: æµ‹è¯•å¯¼èˆª

1. **è¿”å› scan-pay**:
   ```
   ç‚¹å‡»å·¦ä¸Šè§’çš„è¿”å›ç®­å¤´
     â†“
   åº”è¯¥å›åˆ° scan-pay é¡µé¢
   ```

2. **"Make another payment" é“¾æ¥**ï¼ˆå¦‚æœæœ‰è®°å½•ï¼‰:
   ```
   æ»šåŠ¨åˆ°åº•éƒ¨
     â†“
   ç‚¹å‡» "+ Make another payment"
     â†“
   åº”è¯¥è·³è½¬åˆ° scan-pay é¡µé¢
   ```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: é¡µé¢æ˜¾ç¤ºç©ºç™½

**å¯èƒ½åŸå› **:
- æ²¡æœ‰ç™»å½•
- sessionToken è¿‡æœŸ

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—
2. åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•
3. æ£€æŸ¥ localStorage ä¸­çš„ sessionToken

### é—®é¢˜ 2: æ˜¾ç¤º "No payments yet" ä½†å®é™…æœ‰æ”¯ä»˜

**å¯èƒ½åŸå› **:
- ç”¨æˆ·çš„ Pi UID æ²¡æœ‰æ­£ç¡®ä¿å­˜
- æ”¯ä»˜è®°å½•ä¸­çš„ payerUid ä¸åŒ¹é…

**æ’æŸ¥æ–¹æ³•**:
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
console.log("My UID:", localStorage.getItem("pi_uid"));

// å¯¹æ¯”æ•°æ®åº“ä¸­çš„è®°å½•
// æŸ¥è¯¢ï¼š SELECT * FROM "MerchantPayment" WHERE "payerUid" = 'ä½ çš„ UID';
```

### é—®é¢˜ 3: A2U çŠ¶æ€ä¸€ç›´æ˜¯ "Pending"

**å¯èƒ½åŸå› **:
- åå° A2U è½¬è´¦è¿˜åœ¨å¤„ç†
- A2U è½¬è´¦å¤±è´¥ä½†çŠ¶æ€æœªæ›´æ–°

**è§£å†³æ–¹æ³•**:
1. ç­‰å¾…å‡ åˆ†é’Ÿååˆ·æ–°é¡µé¢
2. å±•å¼€è¯¦æƒ…æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥åç«¯æ—¥å¿—

### é—®é¢˜ 4: é‡‘é¢è®¡ç®—ä¸æ­£ç¡®

**æ£€æŸ¥**:
```javascript
// éªŒè¯è®¡ç®—é€»è¾‘
const totalAmount = 3.13;
const merchantAmount = Math.floor(totalAmount * 0.95 * 1000000) / 1000000;
const dividendAmount = Math.ceil(totalAmount * 0.05 * 1000000) / 1000000;

console.log({
  totalAmount,
  merchantAmount,  // åº”è¯¥æ˜¯ 2.9735
  dividendAmount,  // åº”è¯¥æ˜¯ 0.1565
  sum: merchantAmount + dividendAmount  // åº”è¯¥ç­‰äº totalAmount
});
```

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### ç«¯åˆ°ç«¯æµ‹è¯•

1. **æ³¨å†Œå•†å®¶**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰:
   ```
   merchant-code é¡µé¢ â†’ è¾“å…¥èµ·å§‹é‡‘é¢ â†’ Generate â†’ æ”¯ä»˜ â†’ è·å¾—äºŒç»´ç 
   ```

2. **è¿›è¡Œå•†å®¶æ”¯ä»˜**:
   ```
   scan-pay é¡µé¢ â†’ æ‰«æäºŒç»´ç  â†’ è¾“å…¥é‡‘é¢ â†’ Continue to Payment â†’ å®Œæˆæ”¯ä»˜
   ```

3. **æŸ¥çœ‹å†å²è®°å½•**:
   ```
   scan-pay é¡µé¢ â†’ Payment History â†’ æŸ¥çœ‹åˆšåˆšçš„æ”¯ä»˜è®°å½•
   ```

4. **éªŒè¯æ•°æ®**:
   ```
   å±•å¼€è¯¦æƒ… â†’ æ£€æŸ¥æ‰€æœ‰å­—æ®µæ˜¯å¦æ­£ç¡®
   ```

5. **è¿”å›ç»§ç»­æ”¯ä»˜**:
   ```
   ç‚¹å‡»è¿”å›æˆ– "Make another payment" â†’ å›åˆ° scan-pay ç»§ç»­ä½¿ç”¨
   ```

## ğŸ“Š é¢„æœŸçš„æ§åˆ¶å°æ—¥å¿—

### é¡µé¢åŠ è½½æ—¶ï¼š
```
ğŸ“ Getting sessionToken...
âœ… sessionToken obtained
ğŸ“¡ Loading merchant payment history...
âœ… Loaded merchant payment history: 2 records
```

### å¦‚æœå‡ºé”™ï¼š
```
âŒ Failed to load merchant payment history, status: 401
æˆ–
âŒ Error loading merchant payment history: Error: ...
```

## ğŸ‰ æµ‹è¯•æˆåŠŸçš„æ ‡å¿—

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… çœ‹åˆ°æ‰€æœ‰ä½ æ”¯ä»˜è¿‡çš„å•†å®¶è®°å½•
- âœ… æ¯æ¡è®°å½•æ˜¾ç¤ºå®Œæ•´çš„ä¿¡æ¯
- âœ… é‡‘é¢åˆ†è§£æ­£ç¡®ï¼ˆ95% + 5% = 100%ï¼‰
- âœ… å±•å¼€/æ”¶èµ·åŠŸèƒ½æ­£å¸¸
- âœ… çŠ¶æ€é¢œè‰²æ­£ç¡®æ˜¾ç¤º
- âœ… å¯¼èˆªé“¾æ¥å·¥ä½œæ­£å¸¸
- âœ… ç©ºçŠ¶æ€æ˜¾ç¤ºå‹å¥½

## ğŸ“ ä¸‹ä¸€æ­¥

æµ‹è¯•å®Œæˆåï¼Œå¯ä»¥ç»§ç»­æµ‹è¯•ï¼š
1. **å•†å®¶åˆ†çº¢åŠŸèƒ½**: åœ¨ merchant-code é¡µé¢ç‚¹å‡» "Distribute Dividends"
2. **æ‰¹é‡è½¬è´¦åŠŸèƒ½**: åœ¨ oneton é¡µé¢æµ‹è¯•ä¸€å¯¹å¤šè½¬è´¦
3. **çº¢åŒ…åŠŸèƒ½**: åœ¨ red-envelope é¡µé¢æµ‹è¯•çº¢åŒ…å‘æ”¾

---

**æµ‹è¯•æŒ‡å—ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-10-21  
**çŠ¶æ€**: ğŸŸ¢ Ready for Testing

