# æ‰¹é‡è½¬è´¦åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ðŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
npm install
```

### æ­¥éª¤ 2: é…ç½®çŽ¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cat > .env << EOF
DATABASE_URL="postgresql://user:password@localhost:5432/paypi?schema=public"
PI_API_KEY="your_pi_api_key"
PI_WALLET_PRIVATE_SEED="S_YOUR_WALLET_SEED"
EOF
```

**èŽ·å– Pi Network å‡­è¯ï¼š**
1. è®¿é—® [Pi Developer Portal](https://develop.pi/)
2. èŽ·å–ä½ çš„ API Key
3. èŽ·å–åº”ç”¨é’±åŒ…çš„ Private Seedï¼ˆä»¥ 'S' å¼€å¤´ï¼‰

### æ­¥éª¤ 3: è¿è¡Œæ•°æ®åº“è¿ç§»

**æ–¹å¼ 1 - ä½¿ç”¨ npm è„šæœ¬ï¼ˆæŽ¨èï¼‰ï¼š**
```bash
npm run db:migrate:batch
```

**æ–¹å¼ 2 - ä½¿ç”¨è¿ç§»è„šæœ¬ï¼š**
```bash
# macOS/Linux
./scripts/migrate-batch-transfer.sh

# Windows
scripts\migrate-batch-transfer.bat
```

**æ–¹å¼ 3 - æ‰‹åŠ¨æ‰§è¡Œï¼š**
```bash
npx prisma migrate dev --name add_batch_transfer_tables
```

### æ­¥éª¤ 4: å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### æ­¥éª¤ 5: æµ‹è¯•åŠŸèƒ½

1. åœ¨ Pi Browser ä¸­æ‰“å¼€åº”ç”¨
2. å¯¼èˆªåˆ° `/oneton` é¡µé¢
3. æ·»åŠ æµ‹è¯•æ”¶æ¬¾åœ°å€å’Œé‡‘é¢
4. å‘èµ·è½¬è´¦æµ‹è¯•

## ðŸ“ é…ç½®æ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“å·²å¯åŠ¨å¹¶å¯è¿žæŽ¥
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®
- [ ] `PI_API_KEY` å·²è®¾ç½®
- [ ] `PI_WALLET_PRIVATE_SEED` å·²è®¾ç½®
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] ä¾èµ–åŒ…å·²å®‰è£…
- [ ] åº”ç”¨é’±åŒ…æœ‰è¶³å¤Ÿä½™é¢

## ðŸ” éªŒè¯å®‰è£…

### æ£€æŸ¥æ•°æ®åº“è¡¨
```bash
npm run db:studio
```
åœ¨ Prisma Studio ä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- `BatchTransferTask` è¡¨
- `A2UPayment` è¡¨

### æ£€æŸ¥ API æŽ¥å£
```bash
# æµ‹è¯•çŠ¶æ€æŸ¥è¯¢æŽ¥å£ï¼ˆåº”è¿”å›ž 404ï¼‰
curl http://localhost:3000/api/v1/batch-transfer/status?batchId=test
```

## ðŸ“Š è½¬è´¦æµç¨‹å›¾

```
ç”¨æˆ·å‘èµ·æ”¯ä»˜ (U2A)
    â†“
æ”¯ä»˜åˆ°åº”ç”¨é’±åŒ…: GCBQFF4M4MBP7QIJFP752BTREDM25VH7XZEEZMHYKSWXCLK4QLCNQMVV
    â†“
åŽç«¯å¤„ç† (å¼‚æ­¥)
    â”œâ†’ åˆ›å»º A2U æ”¯ä»˜ â†’ æ”¶æ¬¾äºº 1
    â”œâ†’ åˆ›å»º A2U æ”¯ä»˜ â†’ æ”¶æ¬¾äºº 2
    â””â†’ åˆ›å»º A2U æ”¯ä»˜ â†’ æ”¶æ¬¾äºº 3
    â†“
å‰ç«¯è½®è¯¢çŠ¶æ€
    â†“
æ˜¾ç¤ºå®Œæˆç»“æžœ
```

## ðŸŽ¯ NPM è„šæœ¬å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜Ž |
|------|------|
| `npm run db:migrate:batch` | æ‰§è¡Œæ‰¹é‡è½¬è´¦æ•°æ®åº“è¿ç§» |
| `npm run db:migrate` | æ‰§è¡Œæ‰€æœ‰å¾…å¤„ç†çš„è¿ç§» |
| `npm run db:deploy` | ç”Ÿäº§çŽ¯å¢ƒè¿ç§»éƒ¨ç½² |
| `npm run db:studio` | æ‰“å¼€ Prisma Studio |
| `npm run db:generate` | ç”Ÿæˆ Prisma Client |

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿žæŽ¥å¤±è´¥
```
Error: Can't reach database server
```
**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯ `DATABASE_URL` é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®

### 2. Pi Network API é”™è¯¯
```
Error: Pi Network credentials not configured
```
**è§£å†³æ–¹æ³•ï¼š**
- ç¡®è®¤ `PI_API_KEY` å·²è®¾ç½®
- ç¡®è®¤ `PI_WALLET_PRIVATE_SEED` å·²è®¾ç½®
- é‡å¯å¼€å‘æœåŠ¡å™¨

### 3. æ”¶æ¬¾äººæœªæ‰¾åˆ°
```
Error: Cannot find user for address
```
**è§£å†³æ–¹æ³•ï¼š**
- ç¡®ä¿æ”¶æ¬¾äººå·²åœ¨åº”ç”¨ä¸­æ³¨å†Œ
- æ”¶æ¬¾äººçš„é’±åŒ…åœ°å€å·²ä¿å­˜åˆ°æ•°æ®åº“
- æ£€æŸ¥åœ°å€æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆ56ä½å¤§å†™å­—æ¯æ•°å­—ï¼‰

### 4. è¿ç§»å·²å­˜åœ¨
```
Migration 'add_batch_transfer_tables' already exists
```
**è§£å†³æ–¹æ³•ï¼š**
è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¯´æ˜Žè¿ç§»å·²ç»æ‰§è¡Œè¿‡äº†ã€‚å¯ä»¥ä½¿ç”¨ï¼š
```bash
npx prisma migrate deploy
```

## ðŸ“– è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´é…ç½®æŒ‡å—](./BATCH_TRANSFER_SETUP.md)
- [å®žçŽ°æ€»ç»“](./IMPLEMENTATION_SUMMARY.md)
- [A2U æ”¯ä»˜æ–‡æ¡£](./public/Pi%20Network%20-%20Node.JS%20server-side%20package%20A2U%20payment.md)

## ðŸ§ª æµ‹è¯•æµç¨‹

### 1. å‡†å¤‡æµ‹è¯•æ•°æ®
```bash
# åœ¨ Pi Browser ä¸­ç™»å½•åº”ç”¨
# ç¡®ä¿è‡³å°‘æœ‰ 2 ä¸ªæµ‹è¯•è´¦å·
```

### 2. å‘èµ·æµ‹è¯•è½¬è´¦
- æ‰“å¼€ `/oneton` é¡µé¢
- æ·»åŠ æµ‹è¯•åœ°å€ï¼ˆè‡³å°‘ 2 ä¸ªï¼‰
- è¾“å…¥å°é¢é‡‘é¢ï¼ˆå¦‚ 0.01 Piï¼‰
- ç‚¹å‡»"ç»§ç»­è½¬è´¦"

### 3. è§‚å¯Ÿæ—¥å¿—
```bash
# å¼€å‘æ¨¡å¼ä¸‹å¯ä»¥åœ¨æŽ§åˆ¶å°çœ‹åˆ°è¯¦ç»†æ—¥å¿—
npm run dev
```

### 4. æŸ¥çœ‹æ•°æ®åº“
```bash
# æ‰“å¼€ Prisma Studio
npm run db:studio

# æŸ¥çœ‹ BatchTransferTask å’Œ A2UPayment è¡¨
```

## ðŸŽ‰ æˆåŠŸæ ‡å¿—

å¦‚æžœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š
1. âœ… å‰ç«¯æ˜¾ç¤º"æ”¯ä»˜å·²æäº¤ï¼Œæ­£åœ¨åˆ†å‘..."
2. âœ… åŽç«¯æŽ§åˆ¶å°è¾“å‡ºå¤„ç†æ—¥å¿—
3. âœ… æ•°æ®åº“ä¸­æœ‰ BatchTransferTask è®°å½•
4. âœ… æ¯ä¸ªæ”¶æ¬¾äººéƒ½æœ‰å¯¹åº”çš„ A2UPayment è®°å½•
5. âœ… å‰ç«¯æ˜¾ç¤º"æ‰€æœ‰è½¬è´¦å·²æˆåŠŸå®Œæˆï¼"

## ðŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

1. æŸ¥çœ‹ [é…ç½®æŒ‡å—](./BATCH_TRANSFER_SETUP.md) çš„æ•…éšœæŽ’æŸ¥ç« èŠ‚
2. æ£€æŸ¥æŽ§åˆ¶å°å’Œç½‘ç»œè¯·æ±‚æ—¥å¿—
3. åœ¨ Prisma Studio ä¸­æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
4. å‚è€ƒ Pi Network å®˜æ–¹æ–‡æ¡£

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ðŸŽŠ

